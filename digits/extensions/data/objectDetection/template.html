{# Copyright (c) 2016-2017, NVIDIA CORPORATION.  All rights reserved. #}

{% from "helper.html" import print_flashes %}
{% from "helper.html" import print_errors %}
{% from "helper.html" import mark_errors %}

<h3>Object Detection Dataset Options</h3>

<small>
    Images can be stored in any of the supported file formats ('.png','.jpg','.jpeg','.bmp','.ppm').
</small>

<div class="row">
    <div class="col-sm-4 well">
        <div class="row">
            <div class="form-group{{mark_errors([form.resize_channels])}}">
                {{ form.resize_channels.label }}
                {{ form.resize_channels.tooltip }}
                {{ form.resize_channels(class='form-control') }}
            </div>
        </div>
        <div class="row">
            <div class="form-group{{mark_errors([form.resize_width, form.resize_height])}}">
                <label>Image size (Width x Height)</label>
                <span name="resize_dims_explanation"
                      class="explanation-tooltip glyphicon glyphicon-question-sign"
                      data-container="body"
                      title="Input images will be resized to fit."
                ></span>
                <div class="input-group">
                    {{ form.resize_width(size=4, placeholder='width', class='form-control') }}
                    <span class="input-group-addon">x</span>
                    {{ form.resize_height(size=4, placeholder='height', class='form-control') }}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group{{mark_errors([form.resize_mode])}}">
                {{ form.resize_mode.label }}
                {{ form.resize_mode.tooltip }}
                {{ form.resize_mode(class='form-control') }}
            </div>
        </div>
        <div class="row">
            <a class="btn btn-info" href="#" onClick="return showResizeExample();">See example</a>
            <br>
            <br>
            <div id="resize-example" style="display:none;">
                <button class="close" onClick="$('#resize-example').hide();return false;">&times;</button>
                <div id="resize-example-image"></div>
            </div>
            <script>
                function showResizeExample()
                {
                    $.post(
                        "{{url_for('digits.dataset.images.views.resize_example')}}",
                        {
                            "channels": $("#resize_channels").val(),
                            "width":    $("#resize_width").val(),
                            "height":   $("#resize_height").val(),
                            "resize_mode":   $("#resize_mode").val(),
                            "backend": $("#backend").val(),
                            "encoding": $("#encoding").val(),
                        },
                        function(response) {
                            $('#resize-example-image').html(response);
                            $('#resize-example').show();
                        }
                    );
                    return false;
                }
            </script>
        </div>
    </div>

    <div class="col-sm-8">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" id="db-tabs" role="tablist">
            <li><a href="#db-folder" role="tab" data-toggle="tab">Use Image Folder</a></li>
            <li><a href="#db-textfile" role="tab" data-toggle="tab">Use Text Files</a></li>
            <li><a href="#db-s3" role="tab" data-toggle="tab">Use S3</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content well">
            <!-- Folder -->
            <div class="tab-pane" id="db-folder">
                <div class="form-group{{mark_errors([form.folder_train])}}">
                    {{ form.folder_train.label }}
                    {{ form.folder_train.tooltip }}
                    {{ form.folder_train(class='form-control autocomplete_path', placeholder='folder or URL')}}
                </div>
                <div class="row">
                    <div class="col-sm-10 col-sm-offset-1">
                        <small>
                        </small>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6{{mark_errors([form.folder_train_min_per_class])}}">
                        {{ form.folder_train_min_per_class.label }}
                        {{ form.folder_train_min_per_class.tooltip }}
                        {{ form.folder_train_min_per_class(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.folder_train_max_per_class])}}">
                        {{ form.folder_train_max_per_class.label }}
                        {{ form.folder_train_max_per_class.tooltip }}
                        {{ form.folder_train_max_per_class(class='form-control') }}
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6{{mark_errors([form.folder_pct_val])}}">
                        {{ form.folder_pct_val.label }}
                        {{ form.folder_pct_val.tooltip }}
                        {{ form.folder_pct_val(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.folder_pct_test])}}">
                        {{ form.folder_pct_test.label }}
                        {{ form.folder_pct_test.tooltip }}
                        {{ form.folder_pct_test(class='form-control') }}
                    </div>
                </div>
                <br>
                {{form.has_val_folder}}
                {{form.has_val_folder.label}}
                <div style="display:none;" class="form-group{{mark_errors([form.folder_val])}} cl-separate-val-folder">
                    {{ form.folder_val.label }}
                    {{ form.folder_val(class='form-control autocomplete_path') }}
                </div>
                <div class="row cl-separate-val-folder">
                    <div class="form-group col-sm-6{{mark_errors([form.folder_val_min_per_class])}}">
                        {{ form.folder_val_min_per_class.label }}
                        {{ form.folder_val_min_per_class.tooltip }}
                        {{ form.folder_val_min_per_class(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.folder_val_max_per_class])}}">
                        {{ form.folder_val_max_per_class.label }}
                        {{ form.folder_val_max_per_class.tooltip }}
                        {{ form.folder_val_max_per_class(class='form-control') }}
                    </div>
                </div>
                <script>
                    function hasValFolderChanged() {
                        if ($("#has_val_folder").prop("checked"))
                        {
                            $("#folder_val").prop("disabled", false);
                            $(".cl-separate-val-folder").show();
                            $("#folder_pct_val").prop("disabled", true);
                        }
                        else
                        {
                            $(".cl-separate-val-folder").hide();
                            $("#folder_val").prop("disabled", true);
                            $("#folder_pct_val").prop("disabled", false);
                        }
                    }
                    $("#has_val_folder").click(hasValFolderChanged);
                    hasValFolderChanged();
                </script>
                <br>
                {{form.has_test_folder}}
                {{form.has_test_folder.label}}
                <div style="display:none;" class="form-group{{mark_errors([form.folder_test])}} cl-separate-test-folder">
                    {{ form.folder_test.label }}
                    {{ form.folder_test(class='form-control autocomplete_path') }}
                </div>
                <div style="display:none;" class="row cl-separate-test-folder">
                    <div class="form-group col-sm-6{{mark_errors([form.folder_test_min_per_class])}}">
                        {{ form.folder_test_min_per_class.label }}
                        {{ form.folder_test_min_per_class.tooltip }}
                        {{ form.folder_test_min_per_class(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.folder_test_max_per_class])}}">
                        {{ form.folder_test_max_per_class.label }}
                        {{ form.folder_test_max_per_class.tooltip }}
                        {{ form.folder_test_max_per_class(class='form-control') }}
                    </div>
                </div>
                <script>
                    function hasTestFolderChanged() {
                        if ($("#has_test_folder").prop("checked"))
                        {
                            $("#folder_test").prop("disabled", false);
                            $(".cl-separate-test-folder").show();
                            $("#folder_pct_test").prop("disabled", true);
                        }
                        else
                        {
                            $(".cl-separate-test-folder").hide();
                            $("#folder_test").prop("disabled", true);
                            $("#folder_pct_test").prop("disabled", false);
                        }
                    }
                    $("#has_test_folder").click(hasTestFolderChanged);
                    hasTestFolderChanged();
                </script>
            </div>
            <!-- Textfile -->
            <div class="tab-pane" id="db-textfile">
                <div class="row">
                    <table class="table">
                        <tr>
                            <th width="20%">Set</th>

                            <th width="40%">Text file <span name="text_file_explanation"
                                                            class="explanation-tooltip glyphicon glyphicon-question-sign"
                                                            data-container="body"
                                                            title="Each line in the file should be formatted as '<PATH> <LABEL>' where <PATH> specifies image path either on the local filesystem or a URL, and the <LABEL> is a numeric label that matches the uploaded labels file"
                            ></span></th>

                            <th width="40%">Image folder <i>(optional)</i> <span name="image_folder_explanation"
                                                                                 class="explanation-tooltip glyphicon glyphicon-question-sign"
                                                                                 data-container="body"
                                                                                 title="Paths in the text files will be appended with this value before reading"
                            ></span></th>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <label for="{{form.textfile_use_local_files.name}}">
                                    {{form.textfile_use_local_files}}
                                    Use local paths on server
                                </label>
                                <span name="text_file_explanation"
                                      class="explanation-tooltip glyphicon glyphicon-question-sign"
                                      data-container="body"
                                      title="Check to use local paths on server, uncheck to upload files from client machine"
                                ></span>
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><b>Training</b></td>
                            <td class="form-group{{mark_errors([form.textfile_train_images])}} cl-upload-files">
                                {{ form.textfile_train_images(class='form-control') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_local_train_images])}} cl-local-files">
                                {{ form.textfile_local_train_images(class='form-control autocomplete_path',placeholder='enter path') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_train_folder])}}">
                                {{ form.textfile_train_folder(class='form-control autocomplete_path') }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="{{form.textfile_use_val.name}}">
                                    {{form.textfile_use_val}}
                                    Validation
                                </label>
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_val_images])}} cl-upload-files">
                                {{ form.textfile_val_images(class='form-control') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_local_val_images])}} cl-local-files">
                                {{ form.textfile_local_val_images(class='form-control autocomplete_path',placeholder='enter path') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_val_folder])}}">
                                {{ form.textfile_val_folder(class='form-control autocomplete_path') }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="{{form.textfile_use_test.name}}">
                                    {{form.textfile_use_test}}
                                    Test
                                </label>
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_test_images])}} cl-upload-files">
                                {{ form.textfile_test_images(class='form-control') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_local_test_images])}} cl-local-files">
                                {{ form.textfile_local_test_images(class='form-control autocomplete_path',placeholder='enter path') }}
                            </td>
                            <td class="form-group{{mark_errors([form.textfile_test_folder])}}">
                                {{ form.textfile_test_folder(class='form-control autocomplete_path') }}
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-sm-offset-1">
                        <div class="form-group{{mark_errors([form.textfile_shuffle])}}">
                            {{ form.textfile_shuffle.label }}
                            {{ form.textfile_shuffle.tooltip }}
                            {{ form.textfile_shuffle(class='form-control') }}
                        </div>
                        <div class="form-group{{mark_errors([form.textfile_labels_file])}} cl-upload-files">
                            {{ form.textfile_labels_file.label }}
                            {{ form.textfile_labels_file.tooltip }}
                            {{ form.textfile_labels_file(class='form-control') }}
                        </div>
                        <div class="form-group{{mark_errors([form.textfile_local_labels_file])}} cl-local-files">
                            {{ form.textfile_local_labels_file.label }}
                            {{ form.textfile_local_labels_file.tooltip }}
                            {{ form.textfile_local_labels_file(class='form-control autocomplete_path',placeholder='enter path') }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- S3 -->
            <div class="tab-pane" id="db-s3">
                <div class="form-group{{mark_errors([form.s3_endpoint_url])}}">
                    {{ form.s3_endpoint_url.label }}
                    {{ form.s3_endpoint_url.tooltip }}
                    {{ form.s3_endpoint_url(class='form-control', placeholder='S3 Endpoint URL(e.g. https://s3.yourcompany.com:443/)')}}
                </div>
                <div class="form-group{{mark_errors([form.s3_bucket])}}">
                    {{ form.s3_bucket.label }}
                    {{ form.s3_bucket.tooltip }}
                    {{ form.s3_bucket(class='form-control', placeholder='Bucket Name')}}
                </div>
                <div class="form-group{{mark_errors([form.s3_path])}}">
                    {{ form.s3_path.label }}
                    {{ form.s3_path.tooltip }}
                    {{ form.s3_path(class='form-control', placeholder='A Path To Image Folders')}}
                </div>
                <div class="form-group{{mark_errors([form.s3_accesskey])}}">
                    {{ form.s3_accesskey.label }}
                    {{ form.s3_accesskey.tooltip }}
                    {{ form.s3_accesskey(class='form-control', placeholder='S3 Access Key')}}
                </div>
                <div class="form-group{{mark_errors([form.s3_secretkey])}}">
                    {{ form.s3_secretkey.label }}
                    {{ form.s3_secretkey.tooltip }}
                    {{ form.s3_secretkey(class='form-control', placeholder='S3 Secret Key', type='password')}}
                </div>
                <div class="form-group checkbox-fix {{mark_errors([form.s3_keepcopiesondisk])}}">
                    {{ form.s3_keepcopiesondisk(class='form-control', placeholder='S3 Secret Key', type='checkbox')}}
                    {{ form.s3_keepcopiesondisk.label }}
                    {{ form.s3_keepcopiesondisk.tooltip }}
                </div>
                <div class="row">
                    <div class="col-sm-10 col-sm-offset-1">
                        <small>
                        </small>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6{{mark_errors([form.s3_train_min_per_class])}}">
                        {{ form.s3_train_min_per_class.label }}
                        {{ form.s3_train_min_per_class.tooltip }}
                        {{ form.s3_train_min_per_class(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.s3_train_max_per_class])}}">
                        {{ form.s3_train_max_per_class.label }}
                        {{ form.s3_train_max_per_class.tooltip }}
                        {{ form.s3_train_max_per_class(class='form-control') }}
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6{{mark_errors([form.s3_pct_val])}}">
                        {{ form.s3_pct_val.label }}
                        {{ form.s3_pct_val.tooltip }}
                        {{ form.s3_pct_val(class='form-control') }}
                    </div>
                    <div class="form-group col-sm-6{{mark_errors([form.s3_pct_test])}}">
                        {{ form.s3_pct_test.label }}
                        {{ form.s3_pct_test.tooltip }}
                        {{ form.s3_pct_test(class='form-control') }}
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
